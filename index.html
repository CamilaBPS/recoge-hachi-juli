<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jueguito para Juli con amor</title>
<style>
  body {
    margin: 0;
    background: #000;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    font-family: sans-serif;
    position: relative;
  }

  #pantallaInicio {
    position: absolute;
    width: 600px;
    height: 800px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 10;
    color: white;
    background-image: url('fondo_inicio.jpg');
    background-size: cover;
    background-position: center;
    border: 4px solid #fff;
    box-sizing: border-box;
  }

  #pantallaInicio h1 {
    font-size: 36px;
    margin-bottom: 20px;
    text-align: center;
    animation: zoom 1s ease-in-out infinite alternate;
  }

  @keyframes zoom {
    0% { transform: scale(1); }
    100% { transform: scale(1.1); }
  }

  #pantallaInicio button {
    font-size: 24px;
    padding: 10px 20px;
    cursor: pointer;
    border: none;
    border-radius: 10px;
    background: #ffcc00;
    color: #111;
    animation: parpadeo 1s infinite;
  }

  @keyframes parpadeo {
    0%,100%{opacity:1;}
    50%{opacity:0.5;}
  }

  #puntaje { position: absolute; top: 10px; left: calc(50% - 300px); color: white; font-size: 20px; }
  #vidas { position: absolute; top: 10px; right: calc(50% - 300px); color: white; font-size: 20px; }
  #puntajeMaximo { position: absolute; top: 40px; left: calc(50% - 300px); color: #ffcc00; font-size: 16px; }

  canvas {
    width: 600px;
    height: 800px;
    max-width: 600px;
    max-height: 800px;
    min-width: 600px;
    min-height: 800px;
    display: block;
    background: #444;
  }
</style>
</head>
<body>

<div id="pantallaInicio">
  <h1>Recoge Hachi's</h1>
  <button id="btnComenzar">Comenzar</button>
</div>

<div id="puntaje">Puntaje: 0</div>
<div id="vidas">Vidas: 3</div>
<div id="puntajeMaximo">Máximo alcanzado: 0</div>

<canvas id="gameCanvas" width="600" height="800"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = 600;
canvas.height = 800;

let auto = { x: canvas.width/2 - 30, y: canvas.height - 180, width: 60, height: 120, speed: 8 };
let gatitos = [];
let atun = [];
let puntaje = 0;
let vidas = 3;
let velocidadBase = 5;        
let velocidadFondo = velocidadBase;
let contadorGatitos = 0;
let fondoY = 0;
let gameLoopId = null;
let jugando = false;

const imgAuto = new Image(); imgAuto.src = 'auto.png'; let autoCargado=false; imgAuto.onload=()=>{autoCargado=true;};
const imgGatito = new Image(); imgGatito.src = 'gatito.png';
const imgAtun = new Image(); imgAtun.src = 'atun.png';
const imgFondo = new Image(); imgFondo.src = 'fondo.jpg';

const sonidoGatito = new Audio('sonido_gatito.wav');
const sonidoAtun = new Audio('sonido_atun.wav');
const sonidoFondo = new Audio('musica_fondo.wav'); sonidoFondo.loop=true; sonidoFondo.volume=0.5;

let izquierda=false, derecha=false;
document.addEventListener('keydown', e => { if(e.key==='ArrowLeft') izquierda=true; if(e.key==='ArrowRight') derecha=true; });
document.addEventListener('keyup', e => { if(e.key==='ArrowLeft') izquierda=false; if(e.key==='ArrowRight') derecha=false; });

let puntajeMax = sessionStorage.getItem('puntajeMax') ? parseInt(sessionStorage.getItem('puntajeMax')) : 0;
document.getElementById('puntajeMaximo').innerText = 'Máximo alcanzado: ' + puntajeMax;

function crearObjetos() {
  if(Math.random() < 0.02) gatitos.push({ x: Math.random()*(canvas.width-60), y:-60, width:60, height:60 });
  if(Math.random() < 0.015) atun.push({ x: Math.random()*(canvas.width-60), y:-60, width:60, height:60 });
}

function dibujar() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  fondoY += velocidadFondo;
  if(fondoY >= canvas.height) fondoY=0;
  ctx.drawImage(imgFondo,0,fondoY-canvas.height,canvas.width,canvas.height);
  ctx.drawImage(imgFondo,0,fondoY,canvas.width,canvas.height);
  if(autoCargado) ctx.drawImage(imgAuto, auto.x, auto.y, auto.width, auto.height);
  gatitos.forEach(g=>ctx.drawImage(imgGatito,g.x,g.y,g.width,g.height));
  atun.forEach(a=>ctx.drawImage(imgAtun,a.x,a.y,a.width,a.height));
}

function actualizar() {
  if(izquierda && auto.x>0) auto.x -= auto.speed;
  if(derecha && auto.x<canvas.width-auto.width) auto.x += auto.speed;

  gatitos.forEach((g,i)=>{
    g.y += velocidadFondo;
    if(colision(auto,g)){
      contadorGatitos++;
      let puntos = (contadorGatitos===22)?12:10;
      puntaje += puntos;
      sonidoGatito.play().catch(()=>{});
      gatitos.splice(i,1);
      if(puntaje===222) alert('¡Has conseguido ser el mejor pololo del mundo! (y algo más) Feliz día, te amo');
    }
    if(g.y>canvas.height) gatitos.splice(i,1);
  });

  atun.forEach((a,i)=>{
    a.y += velocidadFondo;
    if(colision(auto,a)){
      vidas--;
      sonidoAtun.play().catch(()=>{});
      atun.splice(i,1);
      if(vidas<=0){
        manejarPerdida();
      }
    }
    if(a.y>canvas.height) atun.splice(i,1);
  });

  document.getElementById('puntaje').innerText='Puntaje: '+puntaje;
  document.getElementById('vidas').innerText='Vidas: '+vidas;
}

function colision(obj1,obj2){
  return obj1.x<obj2.x+obj2.width && obj1.x+obj1.width>obj2.x &&
         obj1.y<obj2.y+obj2.height && obj1.y+obj1.height>obj2.y;
}

function manejarPerdida() {
  detenerJuego();
  if(puntaje > puntajeMax){
      puntajeMax = puntaje;
      sessionStorage.setItem('puntajeMax', puntajeMax);
  }
  document.getElementById('puntajeMaximo').innerText = 'Máximo alcanzado: ' + puntajeMax;

  let reiniciar = confirm('Perdiste ñejeje. ¿Quieres jugar de nuevo?');
  if(reiniciar){
      vidas = 3;
      gatitos=[]; atun=[];
      auto.x = canvas.width/2 -30; auto.y = canvas.height-180;
      izquierda=false; derecha=false;

      velocidadFondo = velocidadFondo * 1.2;
      contadorGatitos = 0;
      jugando = true;
      loop();
  } else {
      resetearTodo();
      velocidadFondo = velocidadBase;
      document.getElementById('pantallaInicio').style.display='flex';
  }
}

function resetearTodo(){
  detenerJuego();
  jugando = false;
  puntaje=0; vidas=3; contadorGatitos=0;
  gatitos=[]; atun=[];
  auto.x = canvas.width/2 -30; auto.y = canvas.height-180;
  izquierda=false; derecha=false;
}

function detenerJuego(){ if(gameLoopId) cancelAnimationFrame(gameLoopId); gameLoopId=null; }

function loop(){
  if(!jugando) return;
  crearObjetos();
  actualizar();
  dibujar();
  gameLoopId=requestAnimationFrame(loop);
}

document.getElementById('btnComenzar').addEventListener('click', ()=>{
  document.getElementById('pantallaInicio').style.display='none';
  sonidoFondo.play().catch(()=>{});
  jugando = true;
  loop();
});
</script>

</body>
</html>
